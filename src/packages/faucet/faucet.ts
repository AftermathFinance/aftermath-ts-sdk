import {
	CoinType,
	ApiFaucetRequestBody,
	SuiNetwork,
	SerializedTransaction,
} from "../../types";
import { Caller } from "../../general/utils/caller";
import { Transaction } from "@mysten/sui.js";

export class Faucet extends Caller {
	/////////////////////////////////////////////////////////////////////
	//// Constants
	/////////////////////////////////////////////////////////////////////

	public static readonly constants = {
		defaultRequestAmountUsd: 10,
	};

	/////////////////////////////////////////////////////////////////////
	//// Constructor
	/////////////////////////////////////////////////////////////////////

	constructor(public readonly network?: SuiNetwork) {
		super(network, "faucet");
	}

	/////////////////////////////////////////////////////////////////////
	//// Inspections
	/////////////////////////////////////////////////////////////////////

	public async getIsPackageOnChain(): Promise<boolean> {
		return this.fetchApi("status");
	}

	public async getSupportedCoins(): Promise<CoinType[]> {
		return this.fetchApi("supportedCoins");
	}

	/////////////////////////////////////////////////////////////////////
	//// Events
	/////////////////////////////////////////////////////////////////////

	// TODO: add mint coin event getter

	/////////////////////////////////////////////////////////////////////
	//// Transactions
	/////////////////////////////////////////////////////////////////////

	public async getRequestCoinTransaction(
		coin: CoinType
	): Promise<Transaction> {
		return Transaction.from(
			await this.fetchApi<SerializedTransaction, ApiFaucetRequestBody>(
				"transactions/request",
				{
					coin,
				}
			)
		);
	}
}
